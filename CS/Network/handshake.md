# Handshake

## 3 Way Handshake

3 Way Handshake는 TCP 연결 설정 방식이다.

전송 계층은 데이터가 전송되는 최종적인 경로상의 양 끝단 사이의 연결이 완성되는 곳이다.

따라서 두 끝단이 연결되었다는 것을 보장하기 위해 실제로 데이터가 전달되기 전에 다른 한 쪽이 준비되었다는 것을 알 필요가 있다.

A 프로세스가 연결설정을 요구하고 B 프로세스가 수락한다고 할 때 순서는 아래와 같다.

1. 먼저 A 프로세스는 TCP 헤더의 SYN을 담은 세그먼트를 전송한다.

2. 연결 설정 요구를 받은 B 프로세스가 연결을 수락하려면 이에 대한 긍정 응답을 표시해야한다. 이를 위해 SYN과 ACK 플래그를 지정해 긍정 응답을 표시한다.

3. A 프로세스는 B 프로세스가 전송한 긍정 응답 세그먼트가 제대로 도착했음을 알리기 위해 ACK을 전송한다. 이 때 전송 할 데이터가 있으면 데이터를 전송해도 된다.

## 4 Way Handshake

4 Way Handshake는 TCP 연결 해제 방식이다.

1. 클라이언트가 연결을 종료하겠다는 FIN 플래그를 전송한다. 이때 클라이언트는 FIN-WAIT 상태가 된다.

2. 서버는 FIN 플래그를 받고, 확인메시지 ACK를 보내고 자신의 통신이 끝날때까지 기다리는 CLOSE_WAIT 상태가 된다.

3. 연결 종료할 준비가 되면, 연결 해지를 위한 준비가 되었음을 알리기 위해 클라이언트에게 FIN 플래그를 전송한다. 이때  서버는 LAST-ACK 상태가 된다.

4. 클라이언트는 해지준비가 되었다는 ACK 메시지를 보낸다. 클라이언트는 FIN-WAIT 에서 TIME-WAIT 상태가 된다.

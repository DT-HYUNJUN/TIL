# 경쟁조건과 교착상태

## 경쟁조건(Race Condition)

경쟁조건은 다수의 프로세스가 공유 자원을 조작할 때 타이밍이나 접근 순서에 따라 결과가 달라질 수 있는 상황을 말한다.

예를 들어

공유 자원 count가 있을 때

A 프로세스는
```c
for (int n=0; n<100000; n++) {
  *count = *count + 1
}
```

를 수행하고

B 프로세스는 
```c
for (int n=0; n<100000; n++) {
  *count = *count - 1
}
```

동작을 수행한다고 할 때


각각의 프로세스가 순서를 지키지 않고 공유 자원 count에 접근한다고 하면

두 프로세스가 모두 동작을 하고 count의 결과를 확인하면 매 번 달라지는 것을 확인할 수 있다.

## 교착상태

다중 프로그래밍을 지원하는 OS에서 여러 개의 프로세스들은 제한된 자원들을 공유하여 사용한다.

OS는 요청된 자원이 사용 가능하면 바로 프로세스에게 할당해 주지만, 그 자원이 다른 프로세스가 점유하고 있다면 프로세스를 대기상태에 기다리게 한다.

만약 두 프로세스가 서로 원하는 자원을 점유하고 있는 상태에서 해당 자원을 요청하게 되면 OS는 두 프로세스에게 대기상태에서 기다리게끔 한다.

이렇게 되면 두 프로세스는 결코 자원을 할당받지 않고 무한정 기다리게 되는데 이 상태를 교착상태라고 한다.

### 발생조건

- 상호 배제
    - 프로세스는 그들이 필요로 하는 자원을 상호 배제적으로 사용한다.
- 점유 및 대기
    - 프로세스는 그들에게 이미 할당된 자원을 점유하면서 필요로 하는 자원을 요청한다.
- 비선점
    - 프로세스는 다른 프로세스에게 이미 할당된 자원을 선점하지 못한다.
- 환형 대기
    - N개의 프로세스(P0, P1, ..., PN-1)가 대기상태에 있을 때, P0는 P1이 점유하고 있는 자원을, P1은 P0가 점유하고 있는 자원을 각각 요청한다.